(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{640:function(s,a,t){"use strict";t.r(a);var e=t(3),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"日志打印格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志打印格式"}},[s._v("#")]),s._v(" 日志打印格式")]),s._v(" "),a("p",[s._v("安装nginx默认的日志格式提供的内容少，很多时候不足以帮助我们更好的排查问题，因此我们需要扩展日志内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('http {\n    log_format main \'{\'\n                        \'"timestamp":"$time_iso8601",\'\n                        \'"ip":"$http_x_forwarded_for",\'\n                        \'"client":"$remote_addr",\'\n                        \'"scheme":"$scheme",\'\n                        \'"status": $status,\'\n                        \'"request_method":"$request_method",\'\n                        \'"request":"$request_uri",\'\n                        \'"domain":"$server_name",\'\n                        \'"args":"$args",\'\n                        \'"referer":"$http_referer",\'\n                        \'"size":$body_bytes_sent,\'\n                        \'"responsetime":$request_time,\'\n                        \'"upstreamtime":"$upstream_response_time",\'\n                        \'"upstreamaddr":"$upstream_addr",\'\n                        \'"http_user_agent":"$http_user_agent",\'\n                        \'"https":"$https",\'\n                        \'"hostname":"$hostname",\'\n                        \'"source":"$server_addr",\'\n                        \'"body":"$request_body"\'\n                    \'}\';\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("变量参数解释：")]),s._v(" "),a("ol",[a("li",[s._v("$time_iso8601: Nginx 变量，返回当前时间的 ISO 8601 格式。")]),s._v(" "),a("li",[s._v("$http_x_forwarded_for: Nginx 变量，表示通过 X-Forwarded-For HTTP 头传递的客户端 IP 地址。  （需要添加额外配置）")]),s._v(" "),a("li",[s._v("$remote_addr: Nginx 变量，表示客户端的 IP 地址。 （最近一层连接nginx的ip，如果有使用代理就是代理IP）")]),s._v(" "),a("li",[s._v("$scheme: Nginx 变量，表示请求的协议。")]),s._v(" "),a("li",[s._v("$status: Nginx 变量，表示 HTTP 响应状态码。")]),s._v(" "),a("li",[s._v("$request_method: Nginx 变量，表示请求的方法。")]),s._v(" "),a("li",[s._v("$request_uri: Nginx 变量，表示请求的 URI。")]),s._v(" "),a("li",[s._v("$server_name: Nginx 变量，表示服务器块中的 server_name 指令定义的域名。")]),s._v(" "),a("li",[s._v("$args: Nginx 变量，表示请求的查询字符串。")]),s._v(" "),a("li",[s._v("$http_referer: Nginx 变量，表示请求头中的 Referer 字段。")]),s._v(" "),a("li",[s._v("$body_bytes_sent: Nginx 变量，表示发送的响应体大小。")]),s._v(" "),a("li",[s._v("$request_time: Nginx 变量，表示从接收到第一个字节到发送最后一个字节所花费的时间。")]),s._v(" "),a("li",[s._v("$upstream_response_time: Nginx 变量，表示后端服务器处理请求所花费的时间。")]),s._v(" "),a("li",[s._v("$upstream_addr: Nginx 变量，表示后端服务器的地址。")]),s._v(" "),a("li",[s._v("$http_user_agent: Nginx 变量，表示客户端的 User-Agent 字段。")]),s._v(" "),a("li",[s._v("$https: Nginx 变量，表示请求是否为 HTTPS。")]),s._v(" "),a("li",[s._v("$hostname: Nginx 变量，表示服务器的主机名。（eg: localhost.domainLocalhost, #vm5211）")]),s._v(" "),a("li",[s._v("$server_addr: Nginx 变量，表示服务器的 IP 地址。")]),s._v(" "),a("li",[s._v("$request_body: 请求体内容")])]),s._v(" "),a("h2",{attrs:{id:"访问量统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问量统计"}},[s._v("#")]),s._v(" 访问量统计")]),s._v(" "),a("h3",{attrs:{id:"_1-统计访问ip的uv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-统计访问ip的uv"}},[s._v("#")]),s._v(" 1. 统计访问IP的UV")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),s._v(" access.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-统计访问url的pv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-统计访问url的pv"}},[s._v("#")]),s._v(" 2. 统计访问URL的PV")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $7}'")]),s._v(" access.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-访问最频繁的url"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问最频繁的url"}},[s._v("#")]),s._v(" 3. 访问最频繁的URL")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $7}'")]),s._v(" access.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -r"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-访问最频繁的ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-访问最频繁的ip"}},[s._v("#")]),s._v(" 4. 访问最频繁的IP")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),s._v(" access.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -r"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5-根据时间段统计日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-根据时间段统计日志"}},[s._v("#")]),s._v(" 5. 根据时间段统计日志")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("  access.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/14\\/Mar\\/2015:21/,/14\\/Mar\\/2015:22/p'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);