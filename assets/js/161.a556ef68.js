(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{621:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"elasticsearch集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch集群搭建"}},[s._v("#")]),s._v(" elasticsearch集群搭建")]),s._v(" "),t("p",[s._v("默认情况下，每个节点都会自动分配一个唯一标识，用于管理")]),s._v(" "),t("ul",[t("li",[s._v("data nodes - 存储数据并执行数据相关操作（搜索、聚合）")]),s._v(" "),t("li",[s._v("master nodes - 负责集群范围的管理和配置操作 （添加、删除节点）")]),s._v(" "),t("li",[s._v("client nodes - 将集群请求转发给主节点， 将数据相关请求转发给数据节点")]),s._v(" "),t("li",[s._v("ingest nodes - 在索引之前预处理文档")])]),s._v(" "),t("h3",{attrs:{id:"master节点配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master节点配置"}},[s._v("#")]),s._v(" master节点配置")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称，三台集群，要配置相同的集群名称！！！")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("application\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否有资格被选举为master，ES默认集群中第一台机器为主节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.master")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否存储数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最⼤集群节点数，为了避免脑裂，集群节点数最少为 半数+1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.max_local_storage_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/local/node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1/data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/local/node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1/logs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 network.host 为 0.0.0.0，表示对外开放，如对特定ip开放则改为指定ip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network.host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.0.0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置对外服务http端口，默认为9200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内部节点之间沟通端⼝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("transport.tcp.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写⼊候选主节点的设备地址，在开启服务后可以被选为主节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.seed_hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9301"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9302"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化⼀个新的集群时需要此配置来选举master")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.initial_master_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-3"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置集群中N个节点启动时进行数据恢复，默认为1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway.recover_after_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面的两个配置在安装elasticsearch-head的时候会用到")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启跨域访问支持，默认为false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跨域访问允许的域名地址，(允许所有域名)以上使用正则")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.allow-origin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭xpack")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("h3",{attrs:{id:"slave节点配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#slave节点配置"}},[s._v("#")]),s._v(" slave节点配置")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称，三台集群，要配置相同的集群名称！！！")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("application\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否有资格被选举为master，ES默认集群中第一台机器为主节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.master")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否存储数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最⼤集群节点数，为了避免脑裂，集群节点数最少为 半数+1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.max_local_storage_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/local/node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1/data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/local/node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1/logs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 network.host 为 0.0.0.0，表示对外开放，如对特定ip开放则改为指定ip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network.host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.0.0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置对外服务http端口，默认为9200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内部节点之间沟通端⼝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("transport.tcp.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写⼊候选主节点的设备地址，在开启服务后可以被选为主节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.seed_hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.73.66:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.73.66:9301"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.73.66:9302"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化⼀个新的集群时需要此配置来选举master")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.initial_master_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-3"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置集群中N个节点启动时进行数据恢复，默认为1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway.recover_after_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面的两个配置在安装elasticsearch-head的时候会用到")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启跨域访问支持，默认为false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跨域访问允许的域名地址，(允许所有域名)以上使用正则")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.allow-origin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭xpack")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("h3",{attrs:{id:"配置调整"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置调整"}},[s._v("#")]),s._v(" 配置调整")]),s._v(" "),t("h4",{attrs:{id:"避免脑裂"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#避免脑裂"}},[s._v("#")]),s._v(" 避免脑裂")]),s._v(" "),t("p",[s._v("脑裂： 集群中节点之间的"),t("strong",[s._v("通信")]),s._v("由于网路故障，或者其中某个节点故障而失败。可能会有多个节点认为自己是主节点，从而导致数据不一致。为避免这一情况，\n需要修改如下配置")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确定需要多少票来选举主节点， 最佳配置数为： N/2 + 1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("discovery.zen.minimum_master_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"jvm堆调整"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm堆调整"}},[s._v("#")]),s._v(" JVM堆调整")]),s._v(" "),t("p",[s._v("确保elasticsearch有足够的操作内存，建议最大和最小堆大小的值相同。根据经验，最大堆大小应设置为 RAM 的 50%")]),s._v(" "),t("p",[s._v("config/vm.options")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("-Xms2g\n-Xmx2g\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"禁用交换分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁用交换分区"}},[s._v("#")]),s._v(" 禁用交换分区")]),s._v(" "),t("p",[s._v("换出未使用的内存是一种通用行为，但在 Elasticsearch 的上下文中可能会导致断开连接、性能不佳以及一般情况下 — 不稳定的集群。")]),s._v(" "),t("p",[s._v("可以选择禁用交换分区， 或者修改 配置文件内容：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bootstrap.mlockall")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"调整虚拟内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整虚拟内存"}},[s._v("#")]),s._v(" 调整虚拟内存")]),s._v(" "),t("p",[s._v("为避免耗尽虚拟内存，需要增加对 mmap 计数的限制：")]),s._v(" "),t("p",[s._v("vim /etc/sysctl.conf")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vm.max_map_count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("sysctl -p")]),s._v(" "),t("h4",{attrs:{id:"调整文件描述符限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整文件描述符限制"}},[s._v("#")]),s._v(" 调整文件描述符限制")]),s._v(" "),t("p",[s._v("由于 Elasticsearch 使用了大量的文件描述符，您必须确保定义的限制足够，否则最终可能会丢失数据。")]),s._v(" "),t("p",[s._v("vim /etc/security/limits.conf")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("*               soft    nofile          65536\n*               hard    nofile          65536\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("切换一下账号， 即可配置成功")]),s._v(" "),t("h3",{attrs:{id:"启动集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动集群"}},[s._v("#")]),s._v(" 启动集群")]),s._v(" "),t("ul",[t("li",[s._v("对每个集群实例， 执行命令： "),t("code",[s._v("elasticsearch\\bin\\elasticsearch")])]),s._v(" "),t("li",[s._v("验证："),t("code",[s._v("http://localhost:9200/_cluster/state?pretty")])])]),s._v(" "),t("h2",{attrs:{id:"安全配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全配置"}},[s._v("#")]),s._v(" 安全配置")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("生成证书： "),t("code",[s._v("bin/elasticsearch-certutil ca")])])]),s._v(" "),t("li",[t("p",[s._v("生成密钥： "),t("code",[s._v("bin/elasticsearch-certutil cert --ca ca.p12")])])]),s._v(" "),t("li",[t("p",[s._v("将凭证移动到config目录下， 并修改权限为\n755 "),t("code",[s._v("mkdir config/cert; mv cert.p12 ca.p12 config/cert/; chmod 755 cert.p12 ca.p12")])])]),s._v(" "),t("li",[t("p",[s._v("修改 "),t("code",[s._v("config/elasticsearch.yml")]),s._v("配置文件：")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.allow-origin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.cors.allow-headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Authorization"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Requested"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("With"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Length\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.authc.accept_default_password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.verification_mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" certificate\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.keystore.path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 【es的安装路径】/config/cert/cert.p12\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.truststore.path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 【es的安装路径】/config/cert/cert.p12\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("每台集群节点上执行如下命令, 密码为创建证书输入内容")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/elasticsearch-keystore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" xpack.security.transport.ssl.keystore.secure_password\nbin/elasticsearch-keystore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" xpack.security.transport.ssl.truststore.secure_password\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化账户密码")]),s._v("\nbin/elasticsearch-setup-passwords  interactive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("p",[s._v("elasticsearch_head 连接配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://192.168.1.129:9200/?auth_user=elastic&auth_password=123123\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);