---
title: MySQL-理论
date: 2024-05-05
categories:
  - 中间件
tags:
  - MySQL
---

## 索引

### 创建索引的注意点

1. 索引需要建在查询应用频繁的字段
   eg： where、order by、join on
2. 索引个数需要适量
   索引需要占据磁盘空间，索引越多，磁盘空间占用越大
3. 创建索引时，字段需要具有区分度高、更新频率低的特点
4. 组合索引时，需要按照区分度高排序，高区分度的字段放靠左边，并且满足最左前缀原则

### 普通索引和唯一索引关于性能方面选择

假设设计一个市民系统，用户中包含身份证字段，该字段由于比较长，不适合建立主键索引，同时为了加速检索效率，适合建立非主键索引；对于非主键索引查询：

- 普通索引： 在查询到满足条件的数据后，仍需进行继续查找，找到找出所有满足条件的数据
- 唯一索引： 在查询到满足条件的数据后，直接返回

两者性能上没有太大区别，唯一索引的性能会更高一些（基本可以忽略不计）；普通索引由于已经将页从磁盘读到内存并且同类数据存储在同一页的概率极高，因此从内存页再次查询效率非常高

对于非主键索引更新：

--- tip
**Change Buffer:**

当更新一个数据页时
- 数据页如果在内存中：直接更新，稍后会将该页数据刷入到磁盘
- 数据页不在内存中：在不影响数据一致性前提下，InooDB 会将这些更新操作缓存在 change buffer 中，这样就不需要从磁盘中读入这个数据页了；下次
在读取时候，将数据加载到内存中，然后执行 change buffer 修改，将修改结果返回给用户

**使用场景**

- 对于写多读少，可以使用 change buffer 提高效率
- 对于写后读，由于在写change buffer 后需要立马读磁盘页，会增加 change buffer 的维护代价
---

- 普通索引： 可以使用到 change buffer
- 唯一索引： 所有的更新操作都要先判断这个操作是否违反唯一性约束；需要将索引页读到内存中才能进行判断，此时直接修改内存对比 change buffer 会更快，因此不会用到 change buffer。

由于普通索引可以使用到 change buffer，因此普通索引的更新性能会更高一些

> 总结： 开发中，尽量推荐使用普通索引

### 字符串字段加索引

默认情况下，给字符串字段加索引，索引将作用于整个字符串；由于索引需要占用空间，如果字符串字段长度较长，索引会占用大量空间，因此不建议对整个字符串字段加索引，而是对字符串字段加前缀加索引。

给数据表 字符串字段加前缀索引的语法如下：

```sql
alter table user add index email_idx(email(8));
```

上述字段中，email 字段的前 8 个字符作为索引；


