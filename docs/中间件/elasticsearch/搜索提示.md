---
title: 搜索提示
date: 2023-12-26
categories:
  - 中间件
tags:
  - Elasticsearch
---


## 准备工作

1. 下载elasticsearch；
2. 下载elasticsearch对应版本的插件：
   1. ik分词器（中文分词器）[https://github.com/medcl/elasticsearch-analysis-ik]
   2. pinyin分词器（处理拼音）[https://github.com/medcl/elasticsearch-analysis-pinyin]
3. 将插件解压，并放到下载elasticsearch的插件目录下（/elasticsearch-7.15.0/plugins）；
   ```shell
      unzip elasticsearch-analysis-ik-7.15.0.zip -d ik  # 解压文件，并将内容防止到 ik 目录下（不存在则创建）
      mv ik elasticsearch-7.15.0/plugins/
   ```
4. 重启elasticsearch；

## 创建索引，并自定义分词器

```http request
PUT http://192.168.1.6:9200/my_idx
Content-Type: application/json

{
  "settings": {
    "analysis": {
      "analyzer": {
        "king_word": {
          "tokenizer": "ik_max_word",
          "filter": [
            "custom_pinyin_filter"
          ]
        },
        "king_completion": {
          "tokenizer": "keyword",
          "filter": "custom_pinyin_filter"
        }
      },
      "filter": {
        "custom_pinyin_filter": {
          "type": "pinyin",
          "keep_joined_full_pinyin": true,
          "keep_original": true,
          "remove_duplicated_term": true,
          "none_chinese_pinyin_tokenize": false
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "king_word",
        "search_analyzer": "ik_max_word"
      },
      "name": {
        "type": "completion",
        "analyzer": "king_completion"
      }
    }
  }
}
```