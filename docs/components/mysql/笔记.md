## 互联网公司采用RC级别原因

1. 历史原因

   mysql 主从复制是基于binlog日志进行的，binlog有三种格式：
    * statement： 记录修改的sql
    * row： 记录修改的实际数据
    * mixed： 二者混合使用

   在mysql5.0版本之前，只支持statement格式，而这种格式**RC模式**下存在bug：

| Session1                      | Session2                        |
|-------------------------------|---------------------------------|
| begin                         | begin                           |
| delete from test where id < 6 |                                 |
|                               | insert into test(id) values (3) |
|                               | commit                          |
| commit                        |                                 |

   在master上执行的顺序为先删除 id 小于 6 的数据， 然后在插入 id = 3的数据，而在 binlog 通过后 slave 执行的顺序变成了 先执行 插入 id = 3的数据， 然后删除id 小于 6 的数据


2. RR问题
   
   一、在RR 中 存在间隙锁的 问题， 导致出现**死锁**的概率 比 RC 大的多
   
   
| Session1                                 | Session2                                 |
|------------------------------------------|------------------------------------------|
| begin                                    | begin                                    |
| select * from t where id = 9 for update; |                                          |
|                                          | select * from t where id = 9 for update; |
|                                          | insert into user value(7,7,7)            |
| insert into user value(7,7,7)            |                                          |
| commit                                   |                                          |
|                                          | commit                                   |


   二、在RR 中 条件 未命中索引 会锁表， 在RC 中， 只会锁行

